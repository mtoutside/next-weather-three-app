# 実装ロードマップ

このドキュメントは Next Weather Three App の実装ステップをまとめ、開発方針の継続と進捗の把握を助けます。

## 完了済み
- `useGeolocation` フックによる基本的な位置情報取得
- JMA API から気温を取得し、シェーダに渡すために正規化
- 正規化された気温値に応じて反応するシェーダ

## 今後の予定
1. **天候パラメータの拡充**: 降水量・雲量・天気コードなどを取得し、複数の uniform としてシェーダに渡して表現を豊かにする
2. **自動更新とキャッシュ**: API データを定期的に再取得し、最新の天候を反映するためのキャッシュ戦略を実装する
3. **API キーと環境変数の管理**: OpenWeatherMap など追加の API を導入し、環境変数を利用してキーをサーバサイドで安全に管理する
4. **堅牢なエラーハンドリング**: リトライ処理、オフライン時のフォールバック、位置情報拒否時の入力補助などを追加する
5. **UI/UX の向上**: 天気データ表示コンポーネントやデバッグ用 GUI (例: dat.GUI) を整備し、シェーダパラメータを調整可能にする
6. **テストと CI の整備**: 依存パッケージをインストールし、テスト環境と CI を構築して今後の機能追加に備える

## 現在地の天気予報をシェーダに反映する実装方針
1. **位置情報の取得**: `navigator.geolocation` で緯度・経度を取得し、利用不可の場合はIPベースの位置情報APIを検討する。
2. **天気予報APIへのリクエスト**: Open-MeteoやOpenWeatherMapなどのAPIに座標を渡し、気温・降水量・天気コードなどを取得する。
3. **データの正規化**: 取得した値を0〜1などの扱いやすい範囲に変換し、必要なら数値コードにマッピングする。
4. **シェーダへの受け渡し**: 正規化した値を`uniform`としてシェーダに渡し、温度や降水量を表現のパラメータとして利用する。
5. **描画ロジック**: 天候に応じて色合いや動きを変化させる処理を実装する。例: 晴れ→光量増加、雨→パーティクル降下。
6. **更新処理**: 一定間隔でAPIを再取得し、シェーダを再描画して最新の天候を反映する。
7. **エラーハンドリング**: API失敗時のリトライやキャッシュ利用、位置情報拒否時のフォールバックUIを用意する。
8. **開発・デバッグ**: モックデータやGUIを活用してパラメータの確認や調整を行う。

タスクが完了したり新しいアイデアが出てきた場合は、このロードマップを更新してください。
